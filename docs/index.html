<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="/mixgame/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="팟 리밋 계산기 - Pot Limit 연습">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="POT 계산 연습">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Android meta tags -->
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>POT 계산 연습</title>
  <link rel="manifest" href="manifest.json">

  <!-- JavaScript 호환성 폴리필 -->
  <script>
    // 디버깅 소스맵 관련 오류 방지
    window.preventSourceMapsErrorLogging = true;
    
    // JavaScript 정수 나눗셈 폴리필
    Math.trunc = Math.trunc || function(x) {
      return x < 0 ? Math.ceil(x) : Math.floor(x);
    };

    // Dart의 ~/ 연산자를 JavaScript에서 올바르게 처리
    window.dartIntegerDivision = function(a, b) {
      return Math.floor(a / b);
    };

    // 모듈로 연산 정확히 구현
    window.dartModulo = function(a, b) {
      return ((a % b) + b) % b;
    };

    // 넘버링 연산 조정 - 단위 반올림 처리
    Number.prototype.dartRoundUp = function(step) {
      if (!step || step <= 0) return this.valueOf();
      var value = this.valueOf();
      if (value < 0) return 0;
      var remainder = value % step;
      if (remainder === 0) return value;
      return value + (step - remainder);
    };
    
    // IntI.v8BreakIterator 대신 IntlSegmenter 사용 문제 해결
    if (typeof Intl !== 'undefined' && !Intl.v8BreakIterator) {
      Intl.v8BreakIterator = function() {
        if (Intl.Segmenter) {
          return new Intl.Segmenter();
        }
        // 폴백 처리
        return {
          adoptText: function() {},
          next: function() { return { done: true }; }
        };
      };
    }
  </script>

  <script>
    // The value below is injected by flutter build, do not touch.
    const serviceWorkerVersion = null;
  </script>
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
</head>
<body>
  <script>
    window.addEventListener('load', function(ev) {
      // 디버깅 오류 처리
      window.addEventListener('error', function(event) {
        // 소스 맵 오류 무시
        if (event.filename && event.filename.includes('.map')) {
          event.preventDefault();
          return false;
        }
      });
      
      // 폼 필드 요소 속성 자동 수정 - id나 name 속성이 없는 경우 추가
      function fixFormElements() {
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(function(input, index) {
          if (!input.id && !input.name) {
            input.id = 'flutter-input-' + index;
          }
        });
      }
      
      // DOM 변화 감지하여 폼 요소 수정
      const observer = new MutationObserver(function(mutations) {
        fixFormElements();
      });
      
      // 문서 본문 관찰 시작
      setTimeout(function() {
        observer.observe(document.body, { 
          childList: true, 
          subtree: true 
        });
        // 초기 실행
        fixFormElements();
      }, 1000);
      
      // 캐시 강제 갱신을 위한 설정
      window.applicationCacheEnabled = false;

      // 브라우저 캐시 클리어 시도
      if ('caches' in window) {
        caches.keys().then(function(names) {
          for (let name of names) caches.delete(name);
        });
      }

      // 메인 앱 로드 (최신 방식 사용)
      _flutter.loader.load({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        }
      });
    });
  </script>
</body>
</html>
